{% extends "forum/base.html" %}
{% load static %}
{% load static dict_extras %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-9">

    <h4 class="mb-4">ðŸš© Unresolved Reports</h4>

    {% for report in reports %}
    <div class="card mb-3 shadow-sm border-warning">
      <div class="card-body">

        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-start mb-2">
          <strong>
            {% if report.reply %}
            Reply Report
            {% else %}
            Thread Report
            {% endif %}
          </strong>

          <small class="text-muted">
            {{ report.created_timestamp|timesince }} ago
          </small>
        </div>

        <!-- CONTEXT -->
        <div class="mb-2">

          <!-- THREAD (always exists) -->
          <div>
            <strong>Thread:</strong> {{ report.thread.title }}
          </div>

          <a href="{% url 'thread-view' report.thread.category.slug report.thread.id %}{% if report.reply %}?page={{ reply_page_map|get_item:report.reply.id }}#reply-{{ report.reply.id }}{% endif %}"
            class="small text-decoration-none">
            {% if report.reply %}
            View reply â†’
            {% else %}
            View thread â†’
            {% endif %}
          </a>


          {% if report.reply %}
          <div class="mt-1 text-muted small">
            Reply by:
            {{ report.reply.author.get_full_name|default:"Deleted user" }}
          </div>
          {% endif %}
        </div>

        <!-- REASON -->
        <div class="mt-3">
          <strong>Reason:</strong>
          <p class="mb-0 text-muted">
            {{ report.reason }}
          </p>
        </div>

        <!-- FOOTER -->
        <div class="d-flex justify-content-between align-items-center mt-4">

          <small class="text-muted">
            Reported by
            {% if report.author %}
            {{ report.author.get_full_name|default:report.author.email }}
            {% else %}
            Deleted user
            {% endif %}
          </small>

          <form method="post" action="{% url 'resolve-report' report.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-success"
              onclick="return confirm('Mark this report as resolved?');">
              Resolve
            </button>
          </form>

        </div>

      </div>
    </div>
    {% empty %}
    <div class="alert alert-info text-center">
      No unresolved reports ðŸŽ‰
    </div>
    {% endfor %}

  </div>
</div>
{% endblock content %}